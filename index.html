<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Road to Bali: Ella USA</title>

    <!-- Leaflet CSS (required for Folium maps) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <!-- jQuery and jQuery UI for draggable elements -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" xintegrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
    
    <!-- Custom CSS for Leaflet icons and map elements -->
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .map-title { 
            position: fixed; 
            top: 10px; 
            left: 50px; 
            z-index:1000; 
            font-size:24px; 
            font-weight: bold;
            background-color: #ffffff;
            padding: 5px 15px;
            border: 2px solid grey;
            border-radius: 5px;
            cursor: move;
            font-family: Arial, sans-serif;
        }
        .map-legend {
            position: fixed;
            z-index:1000;
            bottom: 20px;
            right: 20px;
            width: 140px;
            background-color: #ffffff;
            border: 2px solid grey;
            border-radius: 5px;
            padding: 10px;
            font-size:14px;
            font-family: Arial, sans-serif;
            cursor: move;
        }
        .map-legend .legend-title {
            text-align: center;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 90%;
        }
        .map-legend .legend-scale ul {
            margin: 0;
            margin-bottom: 5px;
            padding: 0;
            list-style: none;
        }
        .map-legend .legend-scale ul li {
            font-size: 80%;
            list-style: none;
            margin-left: 0;
            line-height: 18px;
            margin-bottom: 2px;
        }
        .map-legend ul.legend-labels li span {
            display: block;
            float: left;
            height: 16px;
            width: 30px;
            margin-right: 5px;
            margin-left: 0;
            border: 1px solid #999;
        }
        
        /* --- NEW: Style to remove icon background --- */
        .leaflet-div-icon {
            background: none;
            border: none;
        }

        /* --- Mobile Responsive CSS --- */
        @media (max-width: 600px) {
            .map-title {
                font-size: 16px; /* Smaller font size */
                left: 45px;      /* Move it away from the zoom controls */
                top: 10px;
                padding: 4px 10px;
            }
        }
    </style>
</head>
<body>

    <!-- The map container -->
    <div id="map"></div>

    <!-- The draggable title -->
    <div id='maptitle' class='map-title'>
        Road to Bali: Ella USA
    </div>

    <!-- The draggable legend -->
    <div id='maplegend' class='map-legend'>
        <div class='legend-title'>Legend</div>
        <div class='legend-scale'>
          <ul class='legend-labels'>
            <li><span style='background:blue;opacity:0.7;'></span>Day 1</li>
            <li><span style='background:green;opacity:0.7;'></span>Day 2</li>
            <li><span style='background:orange;opacity:0.7;'></span>Day 3</li>
            <li><span style='background:purple;opacity:0.7;'></span>Day 4</li>
            <li><span style='background:red;opacity:0.7;'></span>Day 5</li>
            <li><span style='background:black;opacity:0.7;'></span>Conference Site</li>
          </ul>
        </div>
    </div>

    <script>
        // --- Initialize Draggable Elements ---
        $(function() {
            $("#maplegend").draggable({
                start: function (event, ui) {
                    $(this).css({ right: "auto", top: "auto", bottom: "auto" });
                }
            });
            $("#maptitle").draggable();
        });

        // --- Map Initialization ---
        const map = L.map('map').setView([-8.72, 115.17], 13);

        // --- Tile Layers ---
        const esriSatellite = L.tileLayer(
            'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Esri',
                maxZoom: 18,
            }
        ).addTo(map);

        const mapView = L.tileLayer(
            'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            }
        );
        
        // --- Itinerary Data ---
        const hotelCoords = [-8.73, 115.17];
        const locations = {
            "Day 1": {
                color: "blue",
                places: [
                    { name: "South Kuta Beachwalk", coords: [-8.721, 115.168], description: "Afternoon discovery walk along the beachfront.", icon: "fa-person-walking" },
                    { name: "Balangan Cliff", coords: [-8.79, 115.13], description: "Sunset with sweeping views over the surf bay.", icon: "fa-camera-retro" },
                    { name: "Warung Nikmat", coords: [-8.725, 115.174], description: "Dinner: Homestyle halal Javanese dishes.", icon: "fa-utensils" }
                ]
            },
            "Day 2": {
                color: "green",
                places: [
                    { name: "Taman Hutan Raya Ngurah Rai", coords: [-8.73, 115.19], description: "Morning walk through peaceful mangrove boardwalks.", icon: "fa-tree" },
                    { name: "Jimbaran Bay (North End)", coords: [-8.758, 115.169], description: "Evening sunset stop near the fish market.", icon: "fa-sun" },
                    { name: "Ayam Betutu Khas Gilimanuk (Tuban)", coords: [-8.74, 115.18], description: "Dinner: Halal Balinese spiced chicken.", icon: "fa-utensils" }
                ]
            },
            "Day 3": {
                color: "orange",
                places: [
                    { name: "Kedonganan Fish Market", coords: [-8.76, 115.17], description: "Optional early morning visit to a lively fishing port.", icon: "fa-fish" },
                    { name: "Tegal Wangi Beach", coords: [-8.78, 115.14], description: "Sunset with tide pools & small caves.", icon: "fa-umbrella-beach" },
                    { name: "Nasi Pedas Ibu Andika", coords: [-8.71, 115.18], description: "Dinner: 24-hour halal-friendly spicy rice buffet.", icon: "fa-utensils" }
                ]
            },
            "Day 4": {
                color: "purple",
                places: [
                    { name: "Badung & Kumbasari Traditional Markets", coords: [-8.657, 115.211], description: "Morning visit to traditional markets in Denpasar.", icon: "fa-basket-shopping" },
                    { name: "Sindhu Night Market", coords: [-8.69, 115.26], description: "Evening street food exploration in Sanur.", icon: "fa-utensils" }
                ]
            },
            "Day 5": {
                color: "red",
                places: [
                    { name: "Waterblow Nusa Dua", coords: [-8.807, 115.234], description: "Dramatic sea spray views from an easy walkway.", icon: "fa-cloud-showers-heavy" },
                    { name: "Pantai Geger", coords: [-8.815, 115.225], description: "Quick detour to a quiet white-sand beach.", icon: "fa-umbrella-beach" },
                    { name: "Nasi Tempong Indra (Legian)", coords: [-8.70, 115.18], description: "Lunch: Halal Javanese with fiery sambal.", icon: "fa-utensils" }
                ]
            }
        };

        // --- Helper Function for Distance Calculation ---
        function getDistance(coords1, coords2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (coords2[0] - coords1[0]) * Math.PI / 180;
            const dLon = (coords2[1] - coords1[1]) * Math.PI / 180;
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(coords1[0] * Math.PI / 180) * Math.cos(coords2[0] * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Distance in km
        }

        // --- Create Markers and Layers ---
        const layerGroups = {};

        for (const day in locations) {
            const dayData = locations[day];
            const group = L.layerGroup();
            
            dayData.places.forEach(place => {
                const distance = getDistance(hotelCoords, place.coords);
                const distanceStr = `${distance.toFixed(2)} km`;

                const popupHtml = `<b>${place.name}</b><br>${place.description}<br><b>Distance from hotel:</b> ${distanceStr}`;
                const tooltipText = `${place.name} (${distanceStr})`;

                const icon = L.divIcon({
                    className: `leaflet-div-icon`,
                    iconSize: [30, 42],
                    iconAnchor: [15, 42],
                    popupAnchor: [0, -42],
                    // This creates the colored marker background
                    html: `
                        <div style="font-size: 1.5rem; color: ${dayData.color};">
                            <i class="fa-solid fa-map-marker"></i>
                            <i class="fa-solid ${place.icon}" style="position: absolute; top: 5px; left: 50%; transform: translateX(-50%); color: white; font-size: 0.8rem;"></i>
                        </div>
                    `,
                });

                const marker = L.marker(place.coords, { icon: icon })
                    .bindPopup(popupHtml)
                    .bindTooltip(tooltipText);
                
                marker.addTo(group);
            });
            layerGroups[day] = group;
            group.addTo(map);
        }

        // --- Add Conference Hotel Marker ---
        const hotelIcon = L.divIcon({
            className: 'leaflet-div-icon',
            iconSize: [30, 42],
            iconAnchor: [15, 42],
            popupAnchor: [0, -42],
            html: `
                <div style="font-size: 1.5rem; color: black;">
                    <i class="fa-solid fa-map-marker"></i>
                    <i class="fa-solid fa-building" style="position: absolute; top: 5px; left: 50%; transform: translateX(-50%); color: white; font-size: 0.8rem;"></i>
                </div>
            `,
        });
        L.marker(hotelCoords, { icon: hotelIcon })
            .bindPopup("<b>Discovery Kartika Plaza Hotel</b><br>Main Conference Site")
            .bindTooltip("Conference Site")
            .addTo(map);

        // --- Layer Control ---
        const baseMaps = {
            "Satellite View": esriSatellite,
            "Map View": mapView
        };
        L.control.layers(baseMaps, layerGroups).addTo(map);

    </script>
</body>
</html>
